<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Database Manager</title>
    <style>
        /* [Previous CSS styles remain exactly the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains the same until the bulk actions section] -->
    
    <div class="bulk-actions" id="bulkActions" style="display: none;">
        <div class="select-all">
            <input type="checkbox" id="selectAll" class="select-checkbox" onchange="toggleSelectAll()">
            <label for="selectAll">Select All</label>
        </div>
        <span id="selectedCount" class="selected-count">0 selected</span>
        <button class="btn bulk-edit-btn" onclick="showBulkEditModal()">Bulk Edit</button>
        <button class="btn delete-btn" onclick="confirmBulkDelete()">Delete Selected</button>
    </div>
    
    <!-- [Rest of previous HTML remains the same until the scripts] -->

    <script>
        // [Previous JavaScript variables and functions remain the same until the bulk edit functions]

        function showBulkEditModal() {
            if (selectedProducts.size === 0) {
                showToast('Please select at least one product to edit.', 'warning');
                return;
            }
            document.getElementById('bulkEditModal').style.display = 'block';
        }

        function closeBulkEditModal() {
            document.getElementById('bulkEditModal').style.display = 'none';
            document.getElementById('bulkEditForm').reset();
            // Hide all bulk edit fields
            document.querySelectorAll('[id$="Field"]').forEach(field => {
                field.style.display = 'none';
            });
        }

        function toggleBulkField(field) {
            const fieldElement = document.getElementById(`bulk${field.charAt(0).toUpperCase() + field.slice(1)}Field`);
            const checkbox = document.getElementById(`bulkEdit${field.charAt(0).toUpperCase() + field.slice(1)}`);
            fieldElement.style.display = checkbox.checked ? 'block' : 'none';
        }

        function updateBulkImagePreview() {
            const imageUrl = document.getElementById('bulkImageUrl').value;
            const preview = document.getElementById('bulkImagePreview');
            const placeholder = document.getElementById('bulkImagePreviewPlaceholder');
            
            if (imageUrl) {
                preview.src = imageUrl;
                preview.style.display = 'block';
                placeholder.style.display = 'none';
            } else {
                preview.style.display = 'none';
                placeholder.style.display = 'flex';
            }
        }

        async function applyBulkEdit() {
            const updates = {};
            
            // Collect all the updates
            if (document.getElementById('bulkEditTitle').checked) {
                const title = document.getElementById('bulkTitle').value;
                if (!title) {
                    showToast('Please enter a title for bulk update.', 'warning');
                    return;
                }
                updates.title = title;
            }
            
            if (document.getElementById('bulkEditPrice').checked) {
                const price = document.getElementById('bulkPrice').value;
                if (!price) {
                    showToast('Please enter a price for bulk update.', 'warning');
                    return;
                }
                updates.price = price;
            }
            
            if (document.getElementById('bulkEditImage').checked) {
                const image_url = document.getElementById('bulkImageUrl').value;
                if (!image_url) {
                    showToast('Please enter an image URL for bulk update.', 'warning');
                    return;
                }
                updates.image_url = image_url;
            }
            
            if (document.getElementById('bulkEditCategories').checked) {
                try {
                    updates.categories = JSON.parse(document.getElementById('bulkCategories').value);
                } catch (e) {
                    showToast('Invalid categories format. Please use valid JSON array format.', 'error');
                    return;
                }
            }
            
            if (Object.keys(updates).length === 0) {
                showToast('Please select at least one field to update.', 'warning');
                return;
            }
            
            updates.scraped_date = new Date().toISOString();
            
            try {
                showLoader();
                const saveBtn = document.querySelector('#bulkEditModal .save-btn');
                saveBtn.disabled = true;
                saveBtn.textContent = 'Updating...';
                
                // Process each selected product
                const productIds = Array.from(selectedProducts);
                const promises = productIds.map(productId => 
                    fetch(`/api/products/${productId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(updates)
                    }).then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to update product ${productId}`);
                        }
                        return response.json();
                    })
                );
                
                await Promise.all(promises);
                
                // Close modal and refresh
                closeBulkEditModal();
                await loadProducts();
                showToast(`Updated ${productIds.length} products successfully!`);
            } catch (error) {
                console.error('Error during bulk edit:', error);
                showToast('Error during bulk update. Some products may not have been updated.', 'error');
            } finally {
                hideLoader();
                const saveBtn = document.querySelector('#bulkEditModal .save-btn');
                if (saveBtn) {
                    saveBtn.disabled = false;
                    saveBtn.textContent = 'Apply Changes';
                }
            }
        }

        // [Rest of the JavaScript remains the same]
    </script>
</body>
</html>